%% Параметри задачі
P1_vals = 50:10:150;  % Ціна винограду від 50 до 150 грн (крок 10 грн)
P2 = 20;              % Ціна яблук (фіксована)
I = 300;              % Бюджет споживача

% Ініціалізація векторів результатів
X1 = zeros(size(P1_vals));  % Оптимальна кількість винограду
X2 = zeros(size(P1_vals));  % Оптимальна кількість яблук
MU_Money = zeros(size(P1_vals)); % Гранична корисність грошей

E1_I = zeros(size(P1_vals)); % Еластичність попиту на виноград за доходом
E2_I = zeros(size(P1_vals)); % Еластичність попиту на яблука за доходом

E1_P1 = zeros(size(P1_vals)); % Еластичність попиту на виноград за ціною винограду
E1_P2 = zeros(size(P1_vals)); % Еластичність попиту на виноград за ціною яблук
E2_P1 = zeros(size(P1_vals)); % Еластичність попиту на яблука за ціною винограду
E2_P2 = zeros(size(P1_vals)); % Еластичність попиту на яблука за ціною яблук

% Компенсована заміна ціни (матриця Слуцького)
Comp_X1_P1 = zeros(size(P1_vals));
Comp_X2_P2 = zeros(size(P1_vals));
Comp_X1_P2 = zeros(size(P1_vals));
Comp_X2_P1 = zeros(size(P1_vals));

% Розрахунки для кожного значення P1
for i = 1:length(P1_vals)
    P1 = P1_vals(i);
    
    % Оптимальні обсяги споживання
    X1(i) = (9 * P2 * I + 1280 * P1^2 - 45 * P2^2) / (P1 * (9 * P2 + 64 * P1));
    X2(i) = (64 * P1 * I + 45 * P2^2 - 1280 * P1^2) / (P2 * (9 * P2 + 64 * P1));
    
    % Гранична корисність грошей (λ)
    denom_MU = I - 20 * P1 - 5 * P2;  
    expr_MU = (9 * P2 + 64 * P1) / (P1 * P2 * denom_MU);
    
    if denom_MU > 0 && expr_MU > 0  
        MU_Money(i) = sqrt(expr_MU);
    else
        MU_Money(i) = 0; 
    end
    
    % Еластичність попиту за доходом
    E1_I(i) = (9 * P2 * I) / (9 * P2 * I + 1280 * P1^2 - 45 * P2^2);
    E2_I(i) = (64 * P1 * I) / (64 * P1 * I + 45 * P2^2 - 1280 * P1^2);

    % Еластичність попиту за цінами
    E1_P1(i) = (2560 * P1^2) / (9 * P2 * I + 1280 * P1^2 - 180 * P2^2) / P1 - (64 * P1) / (9 * P2 + 64 * P1) - 1;
    E1_P2(i) = (9 * P2) / P1 * ((I - 10 * P2) / (9 * P2 * I + 1280 * P1^2 - 180 * P2^2) - 1 / (9 * P2 + 64 * P1));
    E2_P1(i) = (64 * P1) / P2 * ((I - 40 * P1) / (64 * P1 * I + 45 * P2^2 - 1280 * P1^2) - 1 / (9 * P2 + 64 * P1));
    E2_P2(i) = (90 * P2^2) / (64 * P1 * I + 45 * P2^2 - 1280 * P1^2) / P2 - (9 * P2) / (9 * P2 + 64 * P1) - 1;
    
    % Компенсована заміна ціни (матриця Слуцького)
    common_term = 1152 * P2 * (20 * P1 + 5 * P2 - I) / (64 * P1 + 9 * P2)^2;
    Comp_X1_P1(i) = common_term / P1;
    Comp_X2_P2(i) = common_term / P2;
    Comp_X1_P2(i) = common_term;
    Comp_X2_P1(i) = common_term;
end

%% Побудова графіків
figure;
subplot(2,2,1);
plot(P1_vals, X1, '-o', 'LineWidth', 1.5);
xlabel('Ціна винограду (грн)');
ylabel('Кількість винограду');
title('Попит на виноград');
grid on;

subplot(2,2,2);
plot(P1_vals, X2, '-o', 'LineWidth', 1.5);
xlabel('Ціна винограду (грн)');
ylabel('Кількість яблук');
title('Попит на яблука');
grid on;

subplot(2,2,3);
plot(P1_vals, MU_Money, '-o', 'LineWidth', 1.5);
xlabel('Ціна винограду (грн)');
ylabel('Гранична корисність грошей');
title('Гранична корисність грошей');
grid on;

figure;
subplot(2,2,1);
plot(P1_vals, E1_I, '-o', P1_vals, E2_I, '-s', 'LineWidth', 1.5);
xlabel('Ціна винограду (грн)');
ylabel('Еластичність за доходом');
legend('Еластичність попиту на виноград за доходом', 'Еластичність попиту на яблука за доходом');
title('Еластичність попиту за доходом');
grid on;

subplot(2,2,2);
plot(P1_vals, E1_P1, '-o', P1_vals, E1_P2, '-s', 'LineWidth', 1.5);
xlabel('Ціна винограду (грн)');
ylabel('Еластичність попиту на виноград');
legend('Еластичність попиту на виноград за його ціною', 'Еластичність попиту на виноград за ціною яблук');
title('Еластичність попиту на виноград');
grid on;

subplot(2,2,3);
plot(P1_vals, E2_P1, '-o', P1_vals, E2_P2, '-s', 'LineWidth', 1.5);
xlabel('Ціна винограду (грн)');
ylabel('Еластичність попиту на яблука');
legend('Еластичність попиту на яблука за ціною винограду', 'Еластичність попиту на яблука за їх ціною');
title('Еластичність попиту на яблука');
grid on;

subplot(2,2,4);
plot(P1_vals, Comp_X1_P1, '-o', P1_vals, Comp_X2_P2, '-s', 'LineWidth', 1.5);
xlabel('Ціна винограду (грн)');
ylabel('Компенсована заміна');
legend('Компенсована заміна попиту на виноград при зміні його ціни', 'Компенсована заміна попиту на яблука при зміні їх ціни');
title('Компенсована заміна ціни');
grid on;
